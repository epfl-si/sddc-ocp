- tags: always
  include_vars: "{{ item }}"
  with_items:
    - resources.yml
    - bootstrap-vars.yml
    - access.yml
    - ssh-public-keys.yml

- name: Work directories for openshift-installer
  file:
    state: directory
    path: "{{ item }}"
  with_items:
    - "{{ bootstrap_topdir }}"
    - "{{ bootstrap_ocp_config_dir }}"

- name: "{{ bootstrap_topdir }}/install-config.yaml"
  copy:
    dest: "{{ bootstrap_topdir }}/install-config.yaml"
    content: >-
      {{ lookup("template", "ocp-bootstrap-install-config.yaml") }}
  vars:
    _redhat_pull_secret: >-
      {{
      lookup("file", bootstrap_pull_secret_file)
      | trim
      | string
      }}

- name: "Create manifests under {{ bootstrap_ocp_config_dir }}/manifests"
  shell:
    creates: "{{ bootstrap_ocp_config_dir }}/manifests"
    cmd: |
      set -e -x
      cp {{ bootstrap_topdir }}/install-config.yaml {{ bootstrap_ocp_config_dir }}/
      openshift-install create manifests --dir {{ bootstrap_ocp_config_dir }}
